# 微服务

* [什么时候才是微服务拆分的最佳时机？](http://blog.itpub.net/31547898/viewspace-2214182/)


## 一、服务拆分

首先，首先在基础设施层面，要有一个持续集成的平台，使得服务在拆分的过程中，功能的一致性，这种一致性不能通过人的经验来，而需要经过大量的回归测试集，并且持续的拆分，持续的演进，持续的集成，从而保证系统时刻处于可以验证交付的状态，而非闭门拆分一段时间，最终谁也不知道功能最终究竟有没有bug，因而需要另外一个月的时间专门修改bug。

其次在接入层，API和UI要动静分离，API由API网关统一的管理，这样后端无论如何拆分，可以保证对于前端来讲，统一的入口，而且可以实现拆分过程中的灰度发布，路由分发，流量切分，从而保证拆分的平滑进行。而且拆分后的微服务之间，为了高性能，是不建议每次调用都进行认证鉴权的，而是在API网关上做统一的认证鉴权，一旦进入网关，服务之间的调用就是可信的。

其三对于数据库，需要进行良好的设计，不应该有大量的联合查询，而是将数据库当成一个简单的key-value查询，复杂的联合查询通过应用层，或者通过Elasticsearch进行。如果数据库表之间耦合的非常严重，其实服务拆分是拆不出来的。

其四要做应用的无状态化，只有无状态的应用，才能横向扩展，这样拆分才有意义。

那么， 满足了服务拆分的基础设施前提之后，我们应该先拆哪个模块，后拆哪个模块呢？在什么情况下一个模块应该拆分出来呢？

切记，微服务拆分绝非一个大跃进运动，由高层发起，把一个应用拆分的七零八落的，最终大大增加运维成本，但是并不会带来收益。

满足上述基本条件后，我们还要看业务变化，才能找到拆分的最佳时机。

第一，有快速迭代的需求。

第二，提交代码频繁出现大量冲突

第三，小功能要积累到大版本才能上线，上线开总监级别大会

 第四，横向扩展流程复杂，主要业务和次要业务耦合

第五，熔断降级全靠if-else